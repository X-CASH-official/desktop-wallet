/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { ReplaySubject } from 'rxjs/index';
import { EASING } from './scroll-to-helpers';
/**
 * Scroll To Animation
 */
var /**
 * Scroll To Animation
 */
ScrollToAnimation = /** @class */ (function () {
    /**
     * Class Constructor.
     *
     * @param _container            The Container
     * @param _listenerTarget       The Element that listens for DOM Events
     * @param _isWindow             Whether or not the listener is the Window
     * @param _to                   Position to scroll to
     * @param _options              Additional options for scrolling
     * @param _isBrowser            Whether or not execution runs in the browser
     *                              (as opposed to the server)
     */
    function ScrollToAnimation(_container, _listenerTarget, _isWindow, _to, _options, _isBrowser) {
        var _this = this;
        this._container = _container;
        this._listenerTarget = _listenerTarget;
        this._isWindow = _isWindow;
        this._to = _to;
        this._options = _options;
        this._isBrowser = _isBrowser;
        /**
         * Recursively loop over the Scroll Animation
         */
        this._loop = function () {
            _this._timeLapsed += _this._tick;
            _this._percentage = (_this._timeLapsed / _this._options.duration);
            _this._percentage = (_this._percentage > 1) ? 1 : _this._percentage;
            // Position Update
            // Position Update
            _this._position = _this._startPosition +
                ((_this._startPosition - _this._to <= 0 ? 1 : -1) *
                    _this._distance *
                    EASING[_this._options.easing](_this._percentage));
            if (_this._lastPosition !== null && _this._position === _this._lastPosition) {
                _this.stop();
            }
            else {
                _this._source$.next(_this._position);
                _this._isWindow
                    ? _this._listenerTarget.scrollTo(0, Math.floor(_this._position))
                    : _this._container.scrollTop = Math.floor(_this._position);
                _this._lastPosition = _this._position;
            }
        };
        this._tick = 16;
        this._interval = null;
        this._lastPosition = null;
        this._timeLapsed = 0;
        this._windowScrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
        if (!this._container) {
            this._startPosition = this._windowScrollTop;
        }
        else {
            this._startPosition = this._isWindow ? this._windowScrollTop : this._container.scrollTop;
        }
        // Correction for Starting Position of nested HTML Elements
        if (this._container && !this._isWindow) {
            this._to = this._to - this._container.getBoundingClientRect().top + this._startPosition;
        }
        // Set Distance
        var /** @type {?} */ directionalDistance = this._startPosition - this._to;
        this._distance = this._container ? Math.abs(this._startPosition - this._to) : this._to;
        this._mappedOffset = this._options.offset;
        // Set offset from Offset Map
        if (this._isBrowser) {
            this._options
                .offsetMap
                .forEach(function (value, key) { return _this._mappedOffset = window.innerWidth > key ? value : _this._mappedOffset; });
        }
        this._distance += this._mappedOffset * (directionalDistance <= 0 ? 1 : -1);
        this._source$ = new ReplaySubject();
    }
    /**
     * Start the new Scroll Animation.
     *
     * @return {?} Observable containing a number
     */
    ScrollToAnimation.prototype.start = /**
     * Start the new Scroll Animation.
     *
     * @return {?} Observable containing a number
     */
    function () {
        clearInterval(this._interval);
        this._interval = setInterval(this._loop, this._tick);
        return this._source$.asObservable();
    };
    /**
     * Stop the current Scroll Animation Loop.
     *
     * @return {?} Void
     */
    ScrollToAnimation.prototype.stop = /**
     * Stop the current Scroll Animation Loop.
     *
     * @return {?} Void
     */
    function () {
        clearInterval(this._interval);
        this._interval = null;
        this._source$.complete();
    };
    return ScrollToAnimation;
}());
/**
 * Scroll To Animation
 */
export { ScrollToAnimation };
function ScrollToAnimation_tsickle_Closure_declarations() {
    /**
     * Number of milliseconds for each Tick
     * @type {?}
     */
    ScrollToAnimation.prototype._tick;
    /**
     * Interval
     * @type {?}
     */
    ScrollToAnimation.prototype._interval;
    /**
     * Time Lapsed in milliseconds
     * @type {?}
     */
    ScrollToAnimation.prototype._timeLapsed;
    /**
     * Percentage of time lapsed
     * @type {?}
     */
    ScrollToAnimation.prototype._percentage;
    /**
     * Position of the Element
     * @type {?}
     */
    ScrollToAnimation.prototype._position;
    /**
     * Last Element Position
     * @type {?}
     */
    ScrollToAnimation.prototype._lastPosition;
    /**
     * Start Position of the Element
     * @type {?}
     */
    ScrollToAnimation.prototype._startPosition;
    /**
     * The Distance to scroll
     * @type {?}
     */
    ScrollToAnimation.prototype._distance;
    /**
     * Observable Source
     * @type {?}
     */
    ScrollToAnimation.prototype._source$;
    /**
     * Scroll Top of the Window
     * @type {?}
     */
    ScrollToAnimation.prototype._windowScrollTop;
    /**
     * Mapped Offset taken from the active Offset Map
     * @type {?}
     */
    ScrollToAnimation.prototype._mappedOffset;
    /**
     * Recursively loop over the Scroll Animation
     * @type {?}
     */
    ScrollToAnimation.prototype._loop;
    /** @type {?} */
    ScrollToAnimation.prototype._container;
    /** @type {?} */
    ScrollToAnimation.prototype._listenerTarget;
    /** @type {?} */
    ScrollToAnimation.prototype._isWindow;
    /** @type {?} */
    ScrollToAnimation.prototype._to;
    /** @type {?} */
    ScrollToAnimation.prototype._options;
    /** @type {?} */
    ScrollToAnimation.prototype._isBrowser;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2Nyb2xsLXRvLWFuaW1hdGlvbi5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BuaWNreS1sZW5hZXJzL25neC1zY3JvbGwtdG8vIiwic291cmNlcyI6WyJzcmMvYXBwL21vZHVsZXMvc2Nyb2xsLXRvL3Njcm9sbC10by1hbmltYXRpb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBYyxhQUFhLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFFdkQsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLHFCQUFxQixDQUFDOzs7O0FBTzdDOzs7QUFBQTtJQW1DRTs7Ozs7Ozs7OztPQVVHO0lBQ0gsMkJBQ1UsWUFDQSxpQkFDUyxXQUNBLEtBQ0EsVUFDVDtRQU5WLGlCQXlDQztRQXhDUyxlQUFVLEdBQVYsVUFBVTtRQUNWLG9CQUFlLEdBQWYsZUFBZTtRQUNOLGNBQVMsR0FBVCxTQUFTO1FBQ1QsUUFBRyxHQUFILEdBQUc7UUFDSCxhQUFRLEdBQVIsUUFBUTtRQUNqQixlQUFVLEdBQVYsVUFBVTs7OztxQkFpREo7WUFFZCxLQUFJLENBQUMsV0FBVyxJQUFJLEtBQUksQ0FBQyxLQUFLLENBQUM7WUFDL0IsS0FBSSxDQUFDLFdBQVcsR0FBRyxDQUFDLEtBQUksQ0FBQyxXQUFXLEdBQUcsS0FBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUMvRCxLQUFJLENBQUMsV0FBVyxHQUFHLENBQUMsS0FBSSxDQUFDLFdBQVcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFJLENBQUMsV0FBVyxDQUFDOztZQUdqRSxBQURBLGtCQUFrQjtZQUNsQixLQUFJLENBQUMsU0FBUyxHQUFHLEtBQUksQ0FBQyxjQUFjO2dCQUNsQyxDQUFDLENBQUMsS0FBSSxDQUFDLGNBQWMsR0FBRyxLQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMs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LGFBQWEsRUFBekUsQ0FBeUUsQ0FBQyxDQUFDO1NBQ3ZHO1FBRUQsSUFBSSxDQUFDLFNBQVMsSUFBSSxJQUFJLENBQUMsYUFBYSxHQUFHLENBQUMsbUJBQW1CLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDM0UsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLGFBQWEsRUFBRSxDQUFDO0tBQ3JDOzs7Ozs7SUFPTSxpQ0FBSzs7Ozs7O1FBQ1YsYUFBYSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUM5QixJQUFJLENBQUMsU0FBUyxHQUFHLFdBQVcsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNyRCxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLEVBQUUsQ0FBQzs7Ozs7OztJQWlDL0IsZ0NBQUk7Ozs7OztRQUNULGFBQWEsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDOUIsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUM7UUFDdEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUUsQ0FBQzs7NEJBOUk3QjtJQWdKQyxDQUFBOzs7O0FBdklELDZCQXVJQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE9ic2VydmFibGUsIFJlcGxheVN1YmplY3QgfSBmcm9tICdyeGpzL2luZGV4JztcclxuXHJcbmltcG9ydCB7IEVBU0lORyB9IGZyb20gJy4vc2Nyb2xsLXRvLWhlbHBlcnMnO1xyXG5pbXBvcnQge1xyXG4gIFNjcm9sbFRvQ29uZmlnT3B0aW9ucyxcclxuICBTY3JvbGxUb0xpc3RlbmVyVGFyZ2V0XHJcbn0gZnJvbSAnLi9zY3JvbGwtdG8tY29uZmlnLmludGVyZmFjZSc7XHJcblxyXG4vKiogU2Nyb2xsIFRvIEFuaW1hdGlvbiAqL1xyXG5leHBvcnQgY2xhc3MgU2Nyb2xsVG9BbmltYXRpb24ge1xyXG5cclxuICAvKiogTnVtYmVyIG9mIG1pbGxpc2Vjb25kcyBmb3IgZWFjaCBUaWNrICovXHJcbiAgcHJpdmF0ZSBfdGljazogbnVtYmVyO1xyXG5cclxuICAvKiogSW50ZXJ2YWwgKi9cclxuICBwcml2YXRlIF9pbnRlcnZhbDogYW55O1xyXG5cclxuICAvKiogVGltZSBMYXBzZWQgaW4gbWlsbGlzZWNvbmRzICovXHJcbiAgcHJpdmF0ZSBfdGltZUxhcHNlZDogbnVtYmVyO1xyXG5cclxuICAvKiogUGVyY2VudGFnZSBvZiB0aW1lIGxhcHNlZCAqL1xyXG4gIHByaXZhdGUgX3BlcmNlbnRhZ2U6IG51bWJlcjtcclxuXHJcbiAgLyoqIFBvc2l0aW9uIG9mIHRoZSBFbGVtZW50ICovXHJcbiAgcHJpdmF0ZSBfcG9zaXRpb246IG51bWJlcjtcclxuXHJcbiAgLyoqIExhc3QgRWxlbWVudCBQb3NpdGlvbiAqL1xyXG4gIHByaXZhdGUgX2xhc3RQb3NpdGlvbjogbnVtYmVyO1xyXG5cclxuICAvKiogU3RhcnQgUG9zaXRpb24gb2YgdGhlIEVsZW1lbnQgKi9cclxuICBwcml2YXRlIF9zdGFydFBvc2l0aW9uOiBudW1iZXI7XHJcblxyXG4gIC8qKiBUaGUgRGlzdGFuY2UgdG8gc2Nyb2xsICovXHJcbiAgcHJpdmF0ZSBfZGlzdGFuY2U6IG51bWJlcjtcclxuXHJcbiAgLyoqIE9ic2VydmFibGUgU291cmNlICovXHJcbiAgcHJpdmF0ZSBfc291cmNlJDogUmVwbGF5U3ViamVjdDxudW1iZXI+O1xyXG5cclxuICAvKiogU2Nyb2xsIFRvcCBvZiB0aGUgV2luZG93ICovXHJcbiAgcHJpdmF0ZSBfd2luZG93U2Nyb2xsVG9wOiBudW1iZXI7XHJcblxyXG4gIC8qKiBNYXBwZWQgT2Zmc2V0IHRha2VuIGZyb20gdGhlIGFjdGl2ZSBPZmZzZXQgTWFwICovXHJcbiAgcHJpdmF0ZSBfbWFwcGVkT2Zmc2V0OiBudW1iZXI7XHJcblxyXG4gIC8qKlxyXG4gICAqIENsYXNzIENvbnN0cnVjdG9yLlxyXG4gICAqXHJcbiAgICogQHBhcmFtIF9jb250YWluZXIgICAgICAgICAgICBUaGUgQ29udGFpbmVyXHJcbiAgICogQHBhcmFtIF9saXN0ZW5lclRhcmdldCAgICAgICBUaGUgRWxlbWVudCB0aGF0IGxpc3RlbnMgZm9yIERPTSBFdmVudHNcclxuICAgKiBAcGFyYW0gX2lzV2luZG93ICAgICAgICAgICAgIFdoZXRoZXIgb3Igbm90IHRoZSBsaXN0ZW5lciBpcyB0aGUgV2luZG93XHJcbiAgICogQHBhcmFtIF90byAgICAgICAgICAgICAgICAgICBQb3NpdGlvbiB0byBzY3JvbGwgdG9cclxuICAgKiBAcGFyYW0gX29wdGlvbnMgICAgICAgICAgICAgIEFkZGl0aW9uYWwgb3B0aW9ucyBmb3Igc2Nyb2xsaW5nXHJcbiAgICogQHBhcmFtIF9pc0Jyb3dzZXIgICAgICAgICAgICBXaGV0aGVyIG9yIG5vdCBleGVjdXRpb24gcnVucyBpbiB0aGUgYnJvd3NlclxyXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGFzIG9wcG9zZWQgdG8gdGhlIHNlcnZlcilcclxuICAgKi9cclxuICBjb25zdHJ1Y3RvcihcclxuICAgIHByaXZhdGUgX2NvbnRhaW5lcjogSFRNTEVsZW1lbnQsXHJcbiAgICBwcml2YXRlIF9saXN0ZW5lclRhcmdldDogU2Nyb2xsVG9MaXN0ZW5lclRhcmdldCxcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgX2lzV2luZG93OiBib29sZWFuLFxyXG4gICAgcHJpdmF0ZSByZWFkb25seSBfdG86IG51bWJlcixcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgX29wdGlvbnM6IFNjcm9sbFRvQ29uZmlnT3B0aW9ucyxcclxuICAgIHByaXZhdGUgX2lzQnJvd3NlcjogYm9vbGVhblxyXG4gICkge1xyXG4gICAgdGhpcy5fdGljayA9IDE2O1xyXG4gICAgdGhpcy5faW50ZXJ2YWwgPSBudWxsO1xyXG4gICAgdGhpcy5fbGFzdFBvc2l0aW9uID0gbnVsbDtcclxuICAgIHRoaXMuX3RpbWVMYXBzZWQgPSAwO1xyXG5cclxuICAgIHRoaXMuX3dpbmRvd1Njcm9sbFRvcCA9IHdpbmRvdy5wYWdlWU9mZnNldCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wIHx8IGRvY3VtZW50LmJvZHkuc2Nyb2xsVG9wIHx8IDA7XHJcblxyXG4gICAgaWYgKCF0aGlzLl9jb250YWluZXIpIHtcclxuICAgICAgdGhpcy5fc3RhcnRQb3NpdGlvbiA9IHRoaXMuX3dpbmRvd1Njcm9sbFRvcDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX3N0YXJ0UG9zaXRpb24gPSB0aGlzLl9pc1dpbmRvdyA/IHRoaXMuX3dpbmRvd1Njcm9sbFRvcCA6IHRoaXMuX2NvbnRhaW5lci5zY3JvbGxUb3A7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ29ycmVjdGlvbiBmb3IgU3RhcnRpbmcgUG9zaXRpb24gb2YgbmVzdGVkIEhUTUwgRWxlbWVudHNcclxuICAgIGlmICh0aGlzLl9jb250YWluZXIgJiYgIXRoaXMuX2lzV2luZG93KSB7XHJcbiAgICAgIHRoaXMuX3RvID0gdGhpcy5fdG8gLSB0aGlzLl9jb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wICsgdGhpcy5fc3RhcnRQb3NpdGlvbjtcclxuICAgIH1cclxuXHJcbiAgICAvLyBTZXQgRGlzdGFuY2VcclxuICAgIGNvbnN0IGRpcmVjdGlvbmFsRGlzdGFuY2UgPSB0aGlzLl9zdGFydFBvc2l0aW9uIC0gdGhpcy5fdG87XHJcbiAgICB0aGlzLl9kaXN0YW5jZSA9IHRoaXMuX2NvbnRhaW5lciA/IE1hdGguYWJzKHRoaXMuX3N0YXJ0UG9zaXRpb24gLSB0aGlzLl90bykgOiB0aGlzLl90bztcclxuXHJcbiAgICB0aGlzLl9tYXBwZWRPZmZzZXQgPSB0aGlzLl9vcHRpb25zLm9mZnNldDtcclxuXHJcbiAgICAvLyBTZXQgb2Zmc2V0IGZyb20gT2Zmc2V0IE1hcFxyXG4gICAgaWYgKHRoaXMuX2lzQnJvd3Nlcikge1xyXG4gICAgICB0aGlzLl9vcHRpb25zXHJcbiAgICAgICAgLm9mZnNldE1hcFxyXG4gICAgICAgIC5mb3JFYWNoKCh2YWx1ZSwga2V5KSA9PiB0aGlzLl9tYXBwZWRPZmZzZXQgPSB3aW5kb3cuaW5uZXJXaWR0aCA+IGtleSA/IHZhbHVlIDogdGhpcy5fbWFwcGVkT2Zmc2V0KTtcclxuICAgIH1cclxuXHJcbiAgICB0aGlzLl9kaXN0YW5jZSArPSB0aGlzLl9tYXBwZWRPZmZzZXQgKiAoZGlyZWN0aW9uYWxEaXN0YW5jZSA8PSAwID8gMSA6IC0xKTtcclxuICAgIHRoaXMuX3NvdXJjZSQgPSBuZXcgUmVwbGF5U3ViamVjdCgpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RhcnQgdGhlIG5ldyBTY3JvbGwgQW5pbWF0aW9uLlxyXG4gICAqXHJcbiAgICogQHJldHVybnMgICAgICAgICBPYnNlcnZhYmxlIGNvbnRhaW5pbmcgYSBudW1iZXJcclxuICAgKi9cclxuICBwdWJsaWMgc3RhcnQoKTogT2JzZXJ2YWJsZTxudW1iZXI+IHtcclxuICAgIGNsZWFySW50ZXJ2YWwodGhpcy5faW50ZXJ2YWwpO1xyXG4gICAgdGhpcy5faW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCh0aGlzLl9sb29wLCB0aGlzLl90aWNrKTtcclxuICAgIHJldHVybiB0aGlzLl9zb3VyY2UkLmFzT2JzZXJ2YWJsZSgpO1xyXG4gIH1cclxuXHJcbiAgLyoqIFJlY3Vyc2l2ZWx5IGxvb3Agb3ZlciB0aGUgU2Nyb2xsIEFuaW1hdGlvbiAqL1xyXG4gIHByaXZhdGUgX2xvb3AgPSAoKTogdm9pZCA9PiB7XHJcblxyXG4gICAgdGhpcy5fdGltZUxhcHNlZCArPSB0aGlzLl90aWNrO1xyXG4gICAgdGhpcy5fcGVyY2VudGFnZSA9ICh0aGlzLl90aW1lTGFwc2VkIC8gdGhpcy5fb3B0aW9ucy5kdXJhdGlvbik7XHJcbiAgICB0aGlzLl9wZXJjZW50YWdlID0gKHRoaXMuX3BlcmNlbnRhZ2UgPiAxKSA/IDEgOiB0aGlzLl9wZXJjZW50YWdlO1xyXG5cclxuICAgIC8vIFBvc2l0aW9uIFVwZGF0ZVxyXG4gICAgdGhpcy5fcG9zaXRpb24gPSB0aGlzLl9zdGFydFBvc2l0aW9uICtcclxuICAgICAgKCh0aGlzLl9zdGFydFBvc2l0aW9uIC0gdGhpcy5fdG8gPD0gMCA/IDEgOiAtMSkgKlxyXG4gICAgICAgIHRoaXMuX2Rpc3RhbmNlICpcclxuICAgICAgICBFQVNJTkdbdGhpcy5fb3B0aW9ucy5lYXNpbmddKHRoaXMuX3BlcmNlbnRhZ2UpKTtcclxuXHJcbiAgICBpZiAodGhpcy5fbGFzdFBvc2l0aW9uICE9PSBudWxsICYmIHRoaXMuX3Bvc2l0aW9uID09PSB0aGlzLl9sYXN0UG9zaXRpb24pIHtcclxuICAgICAgdGhpcy5zdG9wKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLl9zb3VyY2UkLm5leHQodGhpcy5fcG9zaXRpb24pO1xyXG4gICAgICB0aGlzLl9pc1dpbmRvd1xyXG4gICAgICAgID8gdGhpcy5fbGlzdGVuZXJUYXJnZXQuc2Nyb2xsVG8oMCwgTWF0aC5mbG9vcih0aGlzLl9wb3NpdGlvbikpXHJcbiAgICAgICAgOiB0aGlzLl9jb250YWluZXIuc2Nyb2xsVG9wID0gTWF0aC5mbG9vcih0aGlzLl9wb3NpdGlvbik7XHJcbiAgICAgIHRoaXMuX2xhc3RQb3NpdGlvbiA9IHRoaXMuX3Bvc2l0aW9uO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RvcCB0aGUgY3VycmVudCBTY3JvbGwgQW5pbWF0aW9uIExvb3AuXHJcbiAgICpcclxuICAgKiBAcGFyYW0gZm9yY2UgXHRcdFx0ICAgIEZvcmNlIHRvIHN0b3AgdGhlIEFuaW1hdGlvbiBMb29wXHJcbiAgICogQHJldHVybnMgICAgICAgICAgICAgICBWb2lkXHJcbiAgICovXHJcbiAgcHVibGljIHN0b3AoKTogdm9pZCB7XHJcbiAgICBjbGVhckludGVydmFsKHRoaXMuX2ludGVydmFsKTtcclxuICAgIHRoaXMuX2ludGVydmFsID0gbnVsbDtcclxuICAgIHRoaXMuX3NvdXJjZSQuY29tcGxldGUoKTtcclxuICB9XHJcbn1cclxuIl19