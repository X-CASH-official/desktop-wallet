/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes} checked by tsc
 */
import { ReplaySubject } from 'rxjs/index';
import { EASING } from './scroll-to-helpers';
/**
 * Scroll To Animation
 */
export class ScrollToAnimation {
    /**
     * Class Constructor.
     *
     * @param {?} _container            The Container
     * @param {?} _listenerTarget       The Element that listens for DOM Events
     * @param {?} _isWindow             Whether or not the listener is the Window
     * @param {?} _to                   Position to scroll to
     * @param {?} _options              Additional options for scrolling
     * @param {?} _isBrowser            Whether or not execution runs in the browser
     *                              (as opposed to the server)
     */
    constructor(_container, _listenerTarget, _isWindow, _to, _options, _isBrowser) {
        this._container = _container;
        this._listenerTarget = _listenerTarget;
        this._isWindow = _isWindow;
        this._to = _to;
        this._options = _options;
        this._isBrowser = _isBrowser;
        /**
         * Recursively loop over the Scroll Animation
         */
        this._loop = () => {
            this._timeLapsed += this._tick;
            this._percentage = (this._timeLapsed / this._options.duration);
            this._percentage = (this._percentage > 1) ? 1 : this._percentage;
            // Position Update
            this._position = this._startPosition +
                ((this._startPosition - this._to <= 0 ? 1 : -1) *
                    this._distance *
                    EASING[this._options.easing](this._percentage));
            if (this._lastPosition !== null && this._position === this._lastPosition) {
                this.stop();
            }
            else {
                this._source$.next(this._position);
                this._isWindow
                    ? this._listenerTarget.scrollTo(0, Math.floor(this._position))
                    : this._container.scrollTop = Math.floor(this._position);
                this._lastPosition = this._position;
            }
        };
        this._tick = 16;
        this._interval = null;
        this._lastPosition = null;
        this._timeLapsed = 0;
        this._windowScrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
        if (!this._container) {
            this._startPosition = this._windowScrollTop;
        }
        else {
            this._startPosition = this._isWindow ? this._windowScrollTop : this._container.scrollTop;
        }
        // Correction for Starting Position of nested HTML Elements
        if (this._container && !this._isWindow) {
            this._to = this._to - this._container.getBoundingClientRect().top + this._startPosition;
        }
        // Set Distance
        const /** @type {?} */ directionalDistance = this._startPosition - this._to;
        this._distance = this._container ? Math.abs(this._startPosition - this._to) : this._to;
        this._mappedOffset = this._options.offset;
        // Set offset from Offset Map
        if (this._isBrowser) {
            this._options
                .offsetMap
                .forEach((value, key) => this._mappedOffset = window.innerWidth > key ? value : this._mappedOffset);
        }
        this._distance += this._mappedOffset * (directionalDistance <= 0 ? 1 : -1);
        this._source$ = new ReplaySubject();
    }
    /**
     * Start the new Scroll Animation.
     *
     * @return {?} Observable containing a number
     */
    start() {
        clearInterval(this._interval);
        this._interval = setInterval(this._loop, this._tick);
        return this._source$.asObservable();
    }
    /**
     * Stop the current Scroll Animation Loop.
     *
     * @return {?} Void
     */
    stop() {
        clearInterval(this._interval);
        this._interval = null;
        this._source$.complete();
    }
}
function ScrollToAnimation_tsickle_Closure_declarations() {
    /**
     * Number of milliseconds for each Tick
     * @type {?}
     */
    ScrollToAnimation.prototype._tick;
    /**
     * Interval
     * @type {?}
     */
    ScrollToAnimation.prototype._interval;
    /**
     * Time Lapsed in milliseconds
     * @type {?}
     */
    ScrollToAnimation.prototype._timeLapsed;
    /**
     * Percentage of time lapsed
     * @type {?}
     */
    ScrollToAnimation.prototype._percentage;
    /**
     * Position of the Element
     * @type {?}
     */
    ScrollToAnimation.prototype._position;
    /**
     * Last Element Position
     * @type {?}
     */
    ScrollToAnimation.prototype._lastPosition;
    /**
     * Start Position of the Element
     * @type {?}
     */
    ScrollToAnimation.prototype._startPosition;
    /**
     * The Distance to scroll
     * @type {?}
     */
    ScrollToAnimation.prototype._distance;
    /**
     * Observable Source
     * @type {?}
     */
    ScrollToAnimation.prototype._source$;
    /**
     * Scroll Top of the Window
     * @type {?}
     */
    ScrollToAnimation.prototype._windowScrollTop;
    /**
     * Mapped Offset taken from the active Offset Map
     * @type {?}
     */
    ScrollToAnimation.prototype._mappedOffset;
    /**
     * Recursively loop over the Scroll Animation
     * @type {?}
     */
    ScrollToAnimation.prototype._loop;
    /** @type {?} */
    ScrollToAnimation.prototype._container;
    /** @type {?} */
    ScrollToAnimation.prototype._listenerTarget;
    /** @type {?} */
    ScrollToAnimation.prototype._isWindow;
    /** @type {?} */
    ScrollToAnimation.prototype._to;
    /** @type {?} */
    ScrollToAnimation.prototype._options;
    /** @type {?} */
    ScrollToAnimation.prototype._isBrowser;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2Nyb2xsLXRvLWFuaW1hdGlvbi5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BuaWNreS1sZW5hZXJzL25neC1zY3JvbGwtdG8vIiwic291cmNlcyI6WyJzcmMvYXBwL21vZHVsZXMvc2Nyb2xsLXRvL3Njcm9sbC10by1hbmltYXRpb24udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBYyxhQUFhLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFFdkQsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLHFCQUFxQixDQUFDOzs7O0FBTzdDLE1BQU07Ozs7Ozs7Ozs7OztJQThDSixZQUNVLFlBQ0EsaUJBQ1MsV0FDQSxLQUNBLFVBQ1Q7UUFMQSxlQUFVLEdBQVYsVUFBVTtRQUNWLG9CQUFlLEdBQWYsZUFBZTtRQUNOLGNBQVMsR0FBVCxTQUFTO1FBQ1QsUUFBRyxHQUFILEdBQUc7UUFDSCxhQUFRLEdBQVIsUUFBUTtRQUNqQixlQUFVLEdBQVYsVUFBVTs7OztxQkFpREosR0FBUyxFQUFFO1lBRXpCLElBQUksQ0FBQyxXQUFXLElBQUksSUFBSSxDQUFDLEtBQUssQ0FBQztZQUMvQixJQUFJLENBQUMsV0FBVyxHQUFHLENBQUMsSUFBSSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQy9ELElBQUksQ0FBQyxXQUFXLEdBQUcsQ0FBQyxJQUFJLENBQUMsV0FBVyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUM7O1lBR2pFLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLGNBQWM7Z0JBQ2xDLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO29CQUM3QyxJQUFJLENBQUMsU0FBUztvQkFD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LElBQUksQ0FBQyxTQUFTLElBQUksSUFBSSxDQUFDLGFBQWEsR0FBRyxDQUFDLG1CQUFtQixJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzNFLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxhQUFhLEVBQUUsQ0FBQztLQUNyQzs7Ozs7O0lBT00sS0FBSztRQUNWLGFBQWEsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDOUIsSUFBSSxDQUFDLFNBQVMsR0FBRyxXQUFXLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDckQsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsWUFBWSxFQUFFLENBQUM7Ozs7Ozs7SUFpQy9CLElBQUk7UUFDVCxhQUFhLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQzlCLElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDO1FBQ3RCLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxFQUFFLENBQUM7O0NBRTVCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgT2JzZXJ2YWJsZSwgUmVwbGF5U3ViamVjdCB9IGZyb20gJ3J4anMvaW5kZXgnO1xyXG5cclxuaW1wb3J0IHsgRUFTSU5HIH0gZnJvbSAnLi9zY3JvbGwtdG8taGVscGVycyc7XHJcbmltcG9ydCB7XHJcbiAgU2Nyb2xsVG9Db25maWdPcHRpb25zLFxyXG4gIFNjcm9sbFRvTGlzdGVuZXJUYXJnZXRcclxufSBmcm9tICcuL3Njcm9sbC10by1jb25maWcuaW50ZXJmYWNlJztcclxuXHJcbi8qKiBTY3JvbGwgVG8gQW5pbWF0aW9uICovXHJcbmV4cG9ydCBjbGFzcyBTY3JvbGxUb0FuaW1hdGlvbiB7XHJcblxyXG4gIC8qKiBOdW1iZXIgb2YgbWlsbGlzZWNvbmRzIGZvciBlYWNoIFRpY2sgKi9cclxuICBwcml2YXRlIF90aWNrOiBudW1iZXI7XHJcblxyXG4gIC8qKiBJbnRlcnZhbCAqL1xyXG4gIHByaXZhdGUgX2ludGVydmFsOiBhbnk7XHJcblxyXG4gIC8qKiBUaW1lIExhcHNlZCBpbiBtaWxsaXNlY29uZHMgKi9cclxuICBwcml2YXRlIF90aW1lTGFwc2VkOiBudW1iZXI7XHJcblxyXG4gIC8qKiBQZXJjZW50YWdlIG9mIHRpbWUgbGFwc2VkICovXHJcbiAgcHJpdmF0ZSBfcGVyY2VudGFnZTogbnVtYmVyO1xyXG5cclxuICAvKiogUG9zaXRpb24gb2YgdGhlIEVsZW1lbnQgKi9cclxuICBwcml2YXRlIF9wb3NpdGlvbjogbnVtYmVyO1xyXG5cclxuICAvKiogTGFzdCBFbGVtZW50IFBvc2l0aW9uICovXHJcbiAgcHJpdmF0ZSBfbGFzdFBvc2l0aW9uOiBudW1iZXI7XHJcblxyXG4gIC8qKiBTdGFydCBQb3NpdGlvbiBvZiB0aGUgRWxlbWVudCAqL1xyXG4gIHByaXZhdGUgX3N0YXJ0UG9zaXRpb246IG51bWJlcjtcclxuXHJcbiAgLyoqIFRoZSBEaXN0YW5jZSB0byBzY3JvbGwgKi9cclxuICBwcml2YXRlIF9kaXN0YW5jZTogbnVtYmVyO1xyXG5cclxuICAvKiogT2JzZXJ2YWJsZSBTb3VyY2UgKi9cclxuICBwcml2YXRlIF9zb3VyY2UkOiBSZXBsYXlTdWJqZWN0PG51bWJlcj47XHJcblxyXG4gIC8qKiBTY3JvbGwgVG9wIG9mIHRoZSBXaW5kb3cgKi9cclxuICBwcml2YXRlIF93aW5kb3dTY3JvbGxUb3A6IG51bWJlcjtcclxuXHJcbiAgLyoqIE1hcHBlZCBPZmZzZXQgdGFrZW4gZnJvbSB0aGUgYWN0aXZlIE9mZnNldCBNYXAgKi9cclxuICBwcml2YXRlIF9tYXBwZWRPZmZzZXQ6IG51bWJlcjtcclxuXHJcbiAgLyoqXHJcbiAgICogQ2xhc3MgQ29uc3RydWN0b3IuXHJcbiAgICpcclxuICAgKiBAcGFyYW0gX2NvbnRhaW5lciAgICAgICAgICAgIFRoZSBDb250YWluZXJcclxuICAgKiBAcGFyYW0gX2xpc3RlbmVyVGFyZ2V0ICAgICAgIFRoZSBFbGVtZW50IHRoYXQgbGlzdGVucyBmb3IgRE9NIEV2ZW50c1xyXG4gICAqIEBwYXJhbSBfaXNXaW5kb3cgICAgICAgICAgICAgV2hldGhlciBvciBub3QgdGhlIGxpc3RlbmVyIGlzIHRoZSBXaW5kb3dcclxuICAgKiBAcGFyYW0gX3RvICAgICAgICAgICAgICAgICAgIFBvc2l0aW9uIHRvIHNjcm9sbCB0b1xyXG4gICAqIEBwYXJhbSBfb3B0aW9ucyAgICAgICAgICAgICAgQWRkaXRpb25hbCBvcHRpb25zIGZvciBzY3JvbGxpbmdcclxuICAgKiBAcGFyYW0gX2lzQnJvd3NlciAgICAgICAgICAgIFdoZXRoZXIgb3Igbm90IGV4ZWN1dGlvbiBydW5zIGluIHRoZSBicm93c2VyXHJcbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoYXMgb3Bwb3NlZCB0byB0aGUgc2VydmVyKVxyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSBfY29udGFpbmVyOiBIVE1MRWxlbWVudCxcclxuICAgIHByaXZhdGUgX2xpc3RlbmVyVGFyZ2V0OiBTY3JvbGxUb0xpc3RlbmVyVGFyZ2V0LFxyXG4gICAgcHJpdmF0ZSByZWFkb25seSBfaXNXaW5kb3c6IGJvb2xlYW4sXHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IF90bzogbnVtYmVyLFxyXG4gICAgcHJpdmF0ZSByZWFkb25seSBfb3B0aW9uczogU2Nyb2xsVG9Db25maWdPcHRpb25zLFxyXG4gICAgcHJpdmF0ZSBfaXNCcm93c2VyOiBib29sZWFuXHJcbiAgKSB7XHJcbiAgICB0aGlzLl90aWNrID0gMTY7XHJcbiAgICB0aGlzLl9pbnRlcnZhbCA9IG51bGw7XHJcbiAgICB0aGlzLl9sYXN0UG9zaXRpb24gPSBudWxsO1xyXG4gICAgdGhpcy5fdGltZUxhcHNlZCA9IDA7XHJcblxyXG4gICAgdGhpcy5fd2luZG93U2Nyb2xsVG9wID0gd2luZG93LnBhZ2VZT2Zmc2V0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgfHwgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AgfHwgMDtcclxuXHJcbiAgICBpZiAoIXRoaXMuX2NvbnRhaW5lcikge1xyXG4gICAgICB0aGlzLl9zdGFydFBvc2l0aW9uID0gdGhpcy5fd2luZG93U2Nyb2xsVG9wO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5fc3RhcnRQb3NpdGlvbiA9IHRoaXMuX2lzV2luZG93ID8gdGhpcy5fd2luZG93U2Nyb2xsVG9wIDogdGhpcy5fY29udGFpbmVyLnNjcm9sbFRvcDtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDb3JyZWN0aW9uIGZvciBTdGFydGluZyBQb3NpdGlvbiBvZiBuZXN0ZWQgSFRNTCBFbGVtZW50c1xyXG4gICAgaWYgKHRoaXMuX2NvbnRhaW5lciAmJiAhdGhpcy5faXNXaW5kb3cpIHtcclxuICAgICAgdGhpcy5fdG8gPSB0aGlzLl90byAtIHRoaXMuX2NvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3AgKyB0aGlzLl9zdGFydFBvc2l0aW9uO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFNldCBEaXN0YW5jZVxyXG4gICAgY29uc3QgZGlyZWN0aW9uYWxEaXN0YW5jZSA9IHRoaXMuX3N0YXJ0UG9zaXRpb24gLSB0aGlzLl90bztcclxuICAgIHRoaXMuX2Rpc3RhbmNlID0gdGhpcy5fY29udGFpbmVyID8gTWF0aC5hYnModGhpcy5fc3RhcnRQb3NpdGlvbiAtIHRoaXMuX3RvKSA6IHRoaXMuX3RvO1xyXG5cclxuICAgIHRoaXMuX21hcHBlZE9mZnNldCA9IHRoaXMuX29wdGlvbnMub2Zmc2V0O1xyXG5cclxuICAgIC8vIFNldCBvZmZzZXQgZnJvbSBPZmZzZXQgTWFwXHJcbiAgICBpZiAodGhpcy5faXNCcm93c2VyKSB7XHJcbiAgICAgIHRoaXMuX29wdGlvbnNcclxuICAgICAgICAub2Zmc2V0TWFwXHJcbiAgICAgICAgLmZvckVhY2goKHZhbHVlLCBrZXkpID0+IHRoaXMuX21hcHBlZE9mZnNldCA9IHdpbmRvdy5pbm5lcldpZHRoID4ga2V5ID8gdmFsdWUgOiB0aGlzLl9tYXBwZWRPZmZzZXQpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuX2Rpc3RhbmNlICs9IHRoaXMuX21hcHBlZE9mZnNldCAqIChkaXJlY3Rpb25hbERpc3RhbmNlIDw9IDAgPyAxIDogLTEpO1xyXG4gICAgdGhpcy5fc291cmNlJCA9IG5ldyBSZXBsYXlTdWJqZWN0KCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTdGFydCB0aGUgbmV3IFNjcm9sbCBBbmltYXRpb24uXHJcbiAgICpcclxuICAgKiBAcmV0dXJucyAgICAgICAgIE9ic2VydmFibGUgY29udGFpbmluZyBhIG51bWJlclxyXG4gICAqL1xyXG4gIHB1YmxpYyBzdGFydCgpOiBPYnNlcnZhYmxlPG51bWJlcj4ge1xyXG4gICAgY2xlYXJJbnRlcnZhbCh0aGlzLl9pbnRlcnZhbCk7XHJcbiAgICB0aGlzLl9pbnRlcnZhbCA9IHNldEludGVydmFsKHRoaXMuX2xvb3AsIHRoaXMuX3RpY2spO1xyXG4gICAgcmV0dXJuIHRoaXMuX3NvdXJjZSQuYXNPYnNlcnZhYmxlKCk7XHJcbiAgfVxyXG5cclxuICAvKiogUmVjdXJzaXZlbHkgbG9vcCBvdmVyIHRoZSBTY3JvbGwgQW5pbWF0aW9uICovXHJcbiAgcHJpdmF0ZSBfbG9vcCA9ICgpOiB2b2lkID0+IHtcclxuXHJcbiAgICB0aGlzLl90aW1lTGFwc2VkICs9IHRoaXMuX3RpY2s7XHJcbiAgICB0aGlzLl9wZXJjZW50YWdlID0gKHRoaXMuX3RpbWVMYXBzZWQgLyB0aGlzLl9vcHRpb25zLmR1cmF0aW9uKTtcclxuICAgIHRoaXMuX3BlcmNlbnRhZ2UgPSAodGhpcy5fcGVyY2VudGFnZSA+IDEpID8gMSA6IHRoaXMuX3BlcmNlbnRhZ2U7XHJcblxyXG4gICAgLy8gUG9zaXRpb24gVXBkYXRlXHJcbiAgICB0aGlzLl9wb3NpdGlvbiA9IHRoaXMuX3N0YXJ0UG9zaXRpb24gK1xyXG4gICAgICAoKHRoaXMuX3N0YXJ0UG9zaXRpb24gLSB0aGlzLl90byA8PSAwID8gMSA6IC0xKSAqXHJcbiAgICAgICAgdGhpcy5fZGlzdGFuY2UgKlxyXG4gICAgICAgIEVBU0lOR1t0aGlzLl9vcHRpb25zLmVhc2luZ10odGhpcy5fcGVyY2VudGFnZSkpO1xyXG5cclxuICAgIGlmICh0aGlzLl9sYXN0UG9zaXRpb24gIT09IG51bGwgJiYgdGhpcy5fcG9zaXRpb24gPT09IHRoaXMuX2xhc3RQb3NpdGlvbikge1xyXG4gICAgICB0aGlzLnN0b3AoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuX3NvdXJjZSQubmV4dCh0aGlzLl9wb3NpdGlvbik7XHJcbiAgICAgIHRoaXMuX2lzV2luZG93XHJcbiAgICAgICAgPyB0aGlzLl9saXN0ZW5lclRhcmdldC5zY3JvbGxUbygwLCBNYXRoLmZsb29yKHRoaXMuX3Bvc2l0aW9uKSlcclxuICAgICAgICA6IHRoaXMuX2NvbnRhaW5lci5zY3JvbGxUb3AgPSBNYXRoLmZsb29yKHRoaXMuX3Bvc2l0aW9uKTtcclxuICAgICAgdGhpcy5fbGFzdFBvc2l0aW9uID0gdGhpcy5fcG9zaXRpb247XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTdG9wIHRoZSBjdXJyZW50IFNjcm9sbCBBbmltYXRpb24gTG9vcC5cclxuICAgKlxyXG4gICAqIEBwYXJhbSBmb3JjZSBcdFx0XHQgICAgRm9yY2UgdG8gc3RvcCB0aGUgQW5pbWF0aW9uIExvb3BcclxuICAgKiBAcmV0dXJucyAgICAgICAgICAgICAgIFZvaWRcclxuICAgKi9cclxuICBwdWJsaWMgc3RvcCgpOiB2b2lkIHtcclxuICAgIGNsZWFySW50ZXJ2YWwodGhpcy5faW50ZXJ2YWwpO1xyXG4gICAgdGhpcy5faW50ZXJ2YWwgPSBudWxsO1xyXG4gICAgdGhpcy5fc291cmNlJC5jb21wbGV0ZSgpO1xyXG4gIH1cclxufVxyXG4iXX0=